<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Size Comparison Tool</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-style: italic;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .control-group {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
        }
        
        label {
            font-weight: 600;
            min-width: 120px;
        }
        
        select, button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        button {
            background: #007AFF;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }
        
        button:hover {
            background: #0056CC;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        #map {
            height: 600px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        
        .info-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }
        
        .comparison-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #007AFF;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #007AFF;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #fee;
            border: 1px solid #fcc;
            padding: 15px;
            border-radius: 6px;
            color: #c33;
            margin: 15px 0;
        }

        .github-link {
            text-align: center;
            margin: 20px 0;
        }

        .github-link a {
            color: #007AFF;
            text-decoration: none;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üó∫Ô∏è City Size Comparison Tool</h1>
        <p class="subtitle">Compare real city boundaries with interactive overlays - Demo Version</p>
        
        <div class="controls">
            <div class="control-group">
                <label for="baseCity">Base City:</label>
                <select id="baseCity">
                    <option value="">Select base city...</option>
                    <option value="tokyo">Tokyo, Japan (Demo)</option>
                    <option value="new-york">New York City, USA (Demo)</option>
                    <option value="los-angeles">Los Angeles, USA (Demo)</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="overlayCity">Overlay City:</label>
                <select id="overlayCity">
                    <option value="">Select overlay city...</option>
                    <option value="tokyo">Tokyo, Japan (Demo)</option>
                    <option value="new-york">New York City, USA (Demo)</option>
                    <option value="los-angeles">Los Angeles, USA (Demo)</option>
                </select>
            </div>
            
            <div class="control-group">
                <button id="compareBtn" disabled>Compare Cities</button>
                <button id="swapBtn" disabled>Swap Cities</button>
            </div>
        </div>
        
        <div id="map"></div>
        
        <div class="info-panel">
            <div id="status" class="loading">Select two cities to begin comparison...</div>
            <div id="comparison-results"></div>
        </div>

        <div class="github-link">
            <p><strong>This is a demo version.</strong> For the full interactive tool with rotation and translation controls, 
            visit the <a href="https://github.com/yourusername/compare-city-sizes" target="_blank">GitHub repository</a>.</p>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Demo city data with simplified boundaries for GitHub Pages
        const CITIES = {
            'tokyo': {
                name: 'Tokyo, Japan',
                center: [35.6762, 139.6503],
                color: '#FF6B6B',
                // Simplified Tokyo boundary for demo
                boundary: {
                    type: "Feature",
                    properties: { name: "Tokyo" },
                    geometry: {
                        type: "Polygon",
                        coordinates: [[
                            [139.2, 35.4], [139.9, 35.4], [140.0, 35.5], [140.1, 35.6],
                            [140.1, 35.8], [140.0, 35.9], [139.8, 35.95], [139.6, 36.0],
                            [139.4, 35.98], [139.2, 35.9], [139.1, 35.8], [139.1, 35.6],
                            [139.2, 35.4]
                        ]]
                    }
                }
            },
            'new-york': {
                name: 'New York City, USA',
                center: [40.7128, -74.0060],
                color: '#45B7D1',
                // Simplified NYC outline for demo
                boundary: {
                    type: "Feature",
                    properties: { name: "NYC" },
                    geometry: {
                        type: "Polygon",
                        coordinates: [[
                            [-74.05, 40.68], [-73.9, 40.68], [-73.8, 40.75], [-73.8, 40.8],
                            [-73.85, 40.87], [-73.9, 40.9], [-74.0, 40.85], [-74.05, 40.8],
                            [-74.05, 40.68]
                        ]]
                    }
                }
            },
            'los-angeles': {
                name: 'Los Angeles, USA', 
                center: [34.0522, -118.2437],
                color: '#4ECDC4',
                // Simplified LA boundary for demo
                boundary: {
                    type: "Feature",
                    properties: { name: "LA" },
                    geometry: {
                        type: "Polygon",
                        coordinates: [[
                            [-118.6, 33.9], [-118.1, 33.9], [-118.0, 34.0], [-117.9, 34.1],
                            [-117.8, 34.2], [-118.0, 34.3], [-118.2, 34.35], [-118.4, 34.3],
                            [-118.6, 34.2], [-118.7, 34.1], [-118.7, 34.0], [-118.6, 33.9]
                        ]]
                    }
                }
            }
        };

        // Initialize map
        const map = L.map('map').setView([35.6762, 139.6503], 6);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        // Layer groups for cities
        const baseLayer = L.layerGroup().addTo(map);
        const overlayLayer = L.layerGroup().addTo(map);

        // UI elements
        const baseCitySelect = document.getElementById('baseCity');
        const overlayCitySelect = document.getElementById('overlayCity');
        const compareBtn = document.getElementById('compareBtn');
        const swapBtn = document.getElementById('swapBtn');
        const status = document.getElementById('status');
        const results = document.getElementById('comparison-results');

        // Event listeners
        baseCitySelect.addEventListener('change', updateButtons);
        overlayCitySelect.addEventListener('change', updateButtons);
        compareBtn.addEventListener('click', compareCities);
        swapBtn.addEventListener('click', swapCities);

        function updateButtons() {
            const hasBase = baseCitySelect.value;
            const hasOverlay = overlayCitySelect.value;
            const different = hasBase !== hasOverlay;
            
            compareBtn.disabled = !(hasBase && hasOverlay && different);
            swapBtn.disabled = !(hasBase && hasOverlay);
        }

        function calculatePolygonArea(coordinates) {
            if (!coordinates || coordinates.length === 0) return 0;
            
            let area = 0;
            const polygon = coordinates[0]; // Use first polygon
            
            for (let i = 0; i < polygon.length - 1; i++) {
                area += (polygon[i][0] * polygon[i + 1][1] - polygon[i + 1][0] * polygon[i][1]);
            }
            
            return Math.abs(area) / 2;
        }

        function transformPolygon(geojson, newCenter, scaleFactor = 1) {
            const coordinates = geojson.geometry.coordinates[0];
            
            // Calculate current centroid
            let centroidLat = 0, centroidLon = 0;
            coordinates.forEach(coord => {
                centroidLon += coord[0];
                centroidLat += coord[1];
            });
            centroidLat /= coordinates.length;
            centroidLon /= coordinates.length;

            // Transform coordinates
            const transformedCoords = coordinates.map(coord => {
                const deltaLon = (coord[0] - centroidLon) * scaleFactor;
                const deltaLat = (coord[1] - centroidLat) * scaleFactor;
                return [newCenter[1] + deltaLon, newCenter[0] + deltaLat];
            });

            return {
                ...geojson,
                geometry: {
                    ...geojson.geometry,
                    coordinates: [transformedCoords]
                }
            };
        }

        function compareCities() {
            const baseKey = baseCitySelect.value;
            const overlayKey = overlayCitySelect.value;
            
            if (!baseKey || !overlayKey || baseKey === overlayKey) return;
            
            status.innerHTML = '<div class="spinner"></div>Creating city comparison...';
            
            // Clear previous layers
            baseLayer.clearLayers();
            overlayLayer.clearLayers();
            results.innerHTML = '';
            
            try {
                const baseCity = CITIES[baseKey];
                const overlayCity = CITIES[overlayKey];
                
                // Add base city to map
                const baseGeoJsonLayer = L.geoJSON(baseCity.boundary, {
                    style: {
                        color: baseCity.color,
                        weight: 2,
                        opacity: 0.8,
                        fillColor: baseCity.color,
                        fillOpacity: 0.2
                    }
                });
                baseLayer.addLayer(baseGeoJsonLayer);
                
                // Calculate areas for comparison
                const baseArea = calculatePolygonArea(baseCity.boundary.geometry.coordinates);
                const overlayArea = calculatePolygonArea(overlayCity.boundary.geometry.coordinates);
                
                // Transform overlay to base city center
                const transformedOverlay = transformPolygon(overlayCity.boundary, baseCity.center, 1);
                
                // Add transformed overlay to map
                const overlayGeoJsonLayer = L.geoJSON(transformedOverlay, {
                    style: {
                        color: overlayCity.color,
                        weight: 3,
                        opacity: 0.9,
                        fillColor: overlayCity.color,
                        fillOpacity: 0.3,
                        dashArray: '10, 5'
                    }
                });
                overlayLayer.addLayer(overlayGeoJsonLayer);
                
                // Fit map to base city
                map.fitBounds(baseGeoJsonLayer.getBounds(), { padding: [20, 20] });
                
                // Add markers
                L.marker(baseCity.center, {
                    title: baseCity.name
                }).addTo(baseLayer).bindPopup(`<b>${baseCity.name}</b><br>Base Location`);
                
                L.marker(baseCity.center, {
                    title: overlayCity.name
                }).addTo(overlayLayer).bindPopup(`<b>${overlayCity.name}</b><br>Overlay Location<br><em>Simplified boundary</em>`);
                
                // Calculate area ratio
                const areaRatio = (baseArea / overlayArea);
                
                status.textContent = 'Comparison complete! This is a demo with simplified boundaries.';
                
                results.innerHTML = `
                    <h3>Demo City Comparison</h3>
                    <div class="comparison-stats">
                        <div class="stat-card">
                            <div class="stat-value" style="color: ${baseCity.color}">${baseCity.name.split(',')[0]}</div>
                            <div class="stat-label">Base City (Solid)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" style="color: ${overlayCity.color}">${overlayCity.name.split(',')[0]}</div>
                            <div class="stat-label">Overlay City (Dashed)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${areaRatio.toFixed(1)}x</div>
                            <div class="stat-label">Approximate Size Ratio</div>
                        </div>
                    </div>
                    <p style="margin-top: 20px; color: #666; font-size: 14px;">
                        <strong>Demo Version:</strong> This shows simplified city boundaries for demonstration. 
                        The full version includes high-resolution boundary data and interactive transformation controls.
                    </p>
                `;
                
            } catch (error) {
                console.error('Error in comparison:', error);
                status.textContent = 'Error creating comparison. Please try again.';
                results.innerHTML = `<div class="error">Failed to create comparison: ${error.message}</div>`;
            }
        }

        function swapCities() {
            const baseValue = baseCitySelect.value;
            const overlayValue = overlayCitySelect.value;
            
            baseCitySelect.value = overlayValue;
            overlayCitySelect.value = baseValue;
            
            updateButtons();
            
            if (compareBtn.disabled === false) {
                compareCities();
            }
        }

        // Initialize
        updateButtons();
        status.innerHTML = 'Ready! Select two cities to compare their sizes.<br><small>This is a demo version with simplified boundaries.</small>';
    </script>
</body>
</html>